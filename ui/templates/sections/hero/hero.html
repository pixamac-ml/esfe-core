{% load static %}

<section id="hero-section" class="relative h-screen w-full overflow-hidden isolate">

  <!-- ================= BACKGROUND ZOOM ================= -->
  <div class="absolute inset-0 hero-zoom z-0">
    <img src="{% static 'images/hero-bg.jpg' %}"
         class="w-full h-full object-cover"
         alt="Campus ESFE">
    <div class="absolute inset-0 bg-black/65"></div>
  </div>

  <!-- ================= LOGO ================= -->
  <div class="absolute top-6 left-6 z-30">
    <img src="{% static 'images/logo-esfe.png' %}"
         class="h-14 md:h-20 opacity-95"
         alt="Logo ESFE">
  </div>

  <!-- ================= CONTENU CENTRAL ================= -->
  <div class="relative z-20 h-full flex flex-col items-center justify-center text-white px-6 text-center">

    <div class="hero-line">
      <span class="brand">{{ title }}</span>

      <span class="city-mask">
        <span id="cityText" class="city-text"></span>
        <span id="cursor" class="cursor"></span>
      </span>
    </div>

    <p class="hero-tagline">
      <strong>Former les cadres de la santé</strong>
    </p>

  </div>

  <!-- ================= SCROLL BUTTON ================= -->
  <a href="#explorer"
     class="scroll-button"
     aria-label="Aller à la section suivante">
     <span class="arrow">↓</span>
  </a>

</section>
<style>

/* ============================= */
/* HERO ISOLATION (ANTI-BUG)    */
/* ============================= */

#hero-section {
  isolation: isolate; /* empêche les conflits de stacking context */
}

/* ============================= */
/* ZOOM PROPRE SYNCHRONISÉ       */
/* ============================= */

.hero-zoom {
  transform: scale(1);
  transition: transform 18s ease-in-out;
  will-change: transform;
}

/* ============================= */
/* TITRE                         */
/* ============================= */

.hero-line {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: clamp(0.5rem, 2vw, 1.5rem);
  flex-wrap: wrap;
}

.brand,
.city-text {
  font-family: 'Poppins', sans-serif;
  font-size: clamp(3rem, 9vw, 7rem);
  font-weight: 700;
  white-space: nowrap;
}

/* ============================= */
/* WRITING EFFECT                */
/* ============================= */

.city-mask {
  position: relative;
  display: inline-block;
  overflow: hidden;
}

.cursor {
  position: absolute;
  top: 0;
  right: -6px;
  width: 2px;
  height: 100%;
  background: white;
  opacity: 0.7;
  transition: opacity 0.3s ease;
}

/* ============================= */
/* TAGLINE                       */
/* ============================= */

.hero-tagline {
  margin-top: 1.6rem;
  font-size: clamp(1.2rem, 2vw, 1.7rem);
  font-weight: 700;
  opacity: 0.95;
}

/* ============================= */
/* SCROLL BUTTON STABLE         */
/* ============================= */

.scroll-button {
  position: absolute;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 40;

  width: 60px;
  height: 60px;
  border-radius: 50%;

  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(255,255,255,0.4);

  display: flex;
  align-items: center;
  justify-content: center;

  color: white;
  text-decoration: none;
  font-size: 1.6rem;

  transition: all 0.3s ease;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

/* Animation douce permanente */
@keyframes bounceSoft {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(6px); }
}

.scroll-button {
  animation: bounceSoft 2.4s infinite ease-in-out;
}

.scroll-button:hover {
  background: white;
  color: black;
  transform: translateX(-50%) scale(1.08);
}

/* Responsive */
@media (max-width: 640px) {
  .hero-line {
    flex-direction: column;
  }
}

</style>


<script>
document.addEventListener("DOMContentLoaded", function() {

  /* ZOOM DÉCLENCHÉ AU CHARGEMENT */
  const zoom = document.querySelector(".hero-zoom");
  if (zoom) {
    setTimeout(() => {
      zoom.style.transform = "scale(1.05)";
    }, 100);
  }

  /* WRITING ANIMATION */
  const cities = {{ cities|safe }};
  const text = document.getElementById("cityText");
  const cursor = document.getElementById("cursor");

  if (cities && cities.length && text && cursor) {

    let index = 0;

    function animateWord(word) {

      text.textContent = word;

      const duration = word.length * 0.22;

      text.style.transition = "none";
      text.style.clipPath = "inset(0 100% 0 0)";

      requestAnimationFrame(() => {

        text.style.transition =
          `clip-path ${duration}s cubic-bezier(0.4,0,0.2,1)`;

        text.style.clipPath = "inset(0 0 0 0)";
        cursor.style.opacity = 1;

        setTimeout(() => {
          cursor.style.opacity = 0;
          text.style.clipPath = "inset(0 100% 0 0)";
        }, duration * 1000 + 2500);

      });
    }

    function cycle() {
      animateWord(cities[index]);
      index = (index + 1) % cities.length;
    }

    cycle();
    setInterval(cycle, 9000);
  }

});
</script>

