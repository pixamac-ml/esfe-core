{% extends "base.html" %}
{% block title %}{{ page.title }} | {{ institution_name }}{% endblock %}

{% block content %}

<section class="max-w-7xl mx-auto px-6 py-20">

  <div class="grid lg:grid-cols-4 gap-12">

    <!-- ================= LEFT SIDEBAR ================= -->
    <aside class="hidden lg:block lg:col-span-1">
      <div class="sticky top-28 space-y-6 text-sm">

        <div>
          <h3 class="font-semibold text-gray-900 mb-4 uppercase tracking-wide">
            Sommaire
          </h3>

          <ul class="space-y-2">
            {% for section in sections %}
              <li>
                <a href="#section-{{ forloop.counter }}"
                   class="text-gray-600 hover:text-black transition">
                  {{ section.title }}
                </a>
              </li>
            {% empty %}
              <li class="text-gray-400">
                Aucun contenu disponible
              </li>
            {% endfor %}
          </ul>
        </div>

        <div class="pt-6 border-t">
          <a href="{% url 'core:legal_pdf' page.page_type %}"
             class="text-blue-600 font-medium hover:underline">
            Télécharger en PDF
          </a>
        </div>

      </div>
    </aside>


    <!-- ================= MAIN CONTENT ================= -->
    <main class="lg:col-span-2 space-y-14">

      <header>
        <h1 class="text-3xl font-bold text-gray-900">
          {{ page.title }}
        </h1>

        {% if page.introduction %}
          <div class="mt-6 text-gray-600 leading-relaxed prose max-w-none">
            {{ page.introduction|safe }}
          </div>
        {% endif %}

        <div class="mt-6 text-sm text-gray-500">
          Version {{ page.version }} —
          Mise à jour le {{ page.updated_at|date:"d F Y" }}
        </div>
      </header>


      {% for section in sections %}
        <article id="section-{{ forloop.counter }}">
          <h2 class="text-2xl font-semibold mb-6 text-gray-900">
            {{ section.title }}
          </h2>

          <div class="prose prose-gray max-w-none text-sm leading-relaxed">
            {{ section.content|safe }}
          </div>
        </article>
      {% empty %}
        <p class="text-gray-500">
          Aucun contenu disponible pour cette page.
        </p>
      {% endfor %}

    </main>


    <!-- ================= RIGHT SIDEBAR ================= -->
    <aside class="lg:col-span-1">
      <div class="sticky top-28 space-y-8">

        {% if institution %}

        <!-- Bloc Institution -->
        <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
          <h3 class="font-semibold mb-4 uppercase tracking-wide text-sm">
            Établissement
          </h3>

          <div class="text-sm text-gray-600 space-y-1">
            <p><strong>{{ institution.name }}</strong></p>
            <p>{{ institution.address }}</p>
            <p>{{ institution.city }}, {{ institution.country }}</p>
          </div>
        </div>

        <!-- Bloc Contact -->
        <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
          <h3 class="font-semibold mb-4 uppercase tracking-wide text-sm">
            Contact institutionnel
          </h3>

          <div class="text-sm text-gray-600 space-y-1">
            <p>Téléphone : {{ institution.phone }}</p>
            <p>Email : {{ institution.email }}</p>
          </div>
        </div>

        {% if institution.approval_number %}
        <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
          <h3 class="font-semibold mb-4 uppercase tracking-wide text-sm">
            Référence administrative
          </h3>

          <p class="text-sm text-gray-600">
            Numéro d’agrément : {{ institution.approval_number }}
          </p>
        </div>
        {% endif %}

        {% endif %}

        <!-- Bloc Statut -->
        <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
          <h3 class="font-semibold mb-4 uppercase tracking-wide text-sm">
            Statut du document
          </h3>

          <div class="text-sm text-gray-600">
            {% if page.status == "published" %}
              <span class="text-green-600 font-medium">Publié</span>
            {% elif page.status == "review" %}
              <span class="text-yellow-600 font-medium">En révision</span>
            {% else %}
              <span class="text-gray-500 font-medium">Brouillon</span>
            {% endif %}
          </div>
        </div>

      </div>
    </aside>

  </div>

</section>

{% endblock %}
